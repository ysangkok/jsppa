<html>
<head>
				<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
				<title>Constraint tests</title>
				</head>
				<body>
				<table cellpadding="1" cellspacing="1" border="1">
				<thead>
				<tr><td rowspan="1" colspan="3">Create and drop constraints...</td></tr>
				</thead><tbody><tr>
<th colspan="3">Login as janus</th>
</tr>
<tr>
<td>open</td>
<td>http://localhost:8800/ppa/intro.php</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>name=language</td>
<td>English</td>
</tr>
<tr>
<td>open</td>
<td>http://localhost:8800/ppa/login.php?server=localhost:5432:allow&subject=server</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>//input[@name='loginUsername']</td>
<td>admin_user</td>
</tr>
<tr>
<td>type</td>
<td>//input[@id='loginPassword']</td>
<td>super</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=loginSubmit</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//div[@class='topbar']/descendant::span[@class='username']</td>
<td>admin_user</td>
</tr>
<tr>
<th colspan="3">1. Add 2 Foreign Keys</th>
</tr>
<tr>
<th colspan="3">1.1. Add 1st Foreign Keys</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Databases</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=ppatests_db</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Schemas</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=public</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Tables</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=student</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Constraints</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Add foreign key</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=name</td>
<td>student_id_promo_fk</td>
</tr>
<tr>
<td>addSelection</td>
<td>name=TableColumnList</td>
<td>label=id_promo</td>
</tr>
<tr>
<td>click</td>
<td>name=add</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>name=target</td>
<td>label=test_schema.promo</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//input[@value='Add']</td>
<td></td>
</tr>
<tr>
<td>addSelection</td>
<td>name=TableColumnList</td>
<td>label=id</td>
</tr>
<tr>
<td>click</td>
<td>name=add</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>name=upd_action</td>
<td>label=CASCADE</td>
</tr>
<tr>
<td>select</td>
<td>name=del_action</td>
<td>label=RESTRICT</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//input[@value='Add']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Foreign key added.</td>
</tr>
<tr>
<th colspan="3">1.2. Add 2nd Foreign Keys</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Add foreign key</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=name</td>
<td>fk_to_drop</td>
</tr>
<tr>
<td>addSelection</td>
<td>name=TableColumnList</td>
<td>label=id_promo</td>
</tr>
<tr>
<td>click</td>
<td>name=add</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>name=target</td>
<td>label=test_schema.promo</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//input[@value='Add']</td>
<td></td>
</tr>
<tr>
<td>addSelection</td>
<td>name=TableColumnList</td>
<td>label=id</td>
</tr>
<tr>
<td>click</td>
<td>name=add</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>name=upd_action</td>
<td>label=CASCADE</td>
</tr>
<tr>
<td>select</td>
<td>name=del_action</td>
<td>label=RESTRICT</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//input[@value='Add']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Foreign key added.</td>
</tr>
<tr>
<th colspan="3">2. Add check constraint</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Add check</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=name</td>
<td>check_to_drop</td>
</tr>
<tr>
<td>type</td>
<td>name=definition</td>
<td>extract(year from birthday) &lt; 2000</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=ok</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Check constraint added.</td>
</tr>
<tr>
<th colspan="3">3. Add unique key</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Add unique key</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=name</td>
<td>unique_to_drop</td>
</tr>
<tr>
<td>addSelection</td>
<td>name=TableColumnList</td>
<td>label=name</td>
</tr>
<tr>
<td>click</td>
<td>name=add</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//input[@value='Add']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Unique key added.</td>
</tr>
<tr>
<th colspan="3">4. Drop PK before creating it again</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td/pre[text()='PRIMARY KEY (id)']/../../td/a[text()='Drop']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=drop</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Constraint dropped.</td>
</tr>
<tr>
<th colspan="3">5. Add primary key</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Add primary key</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=name</td>
<td>student_pk</td>
</tr>
<tr>
<td>addSelection</td>
<td>name=TableColumnList</td>
<td>label=id</td>
</tr>
<tr>
<td>click</td>
<td>name=add</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//input[@value='Add']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Primary key added.</td>
</tr>
<tr>
<th colspan="3">6. Drop FK</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td[text()='fk_to_drop']/../td/a[text()='Drop']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=drop</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Constraint dropped.</td>
</tr>
<tr>
<th colspan="3">7. Drop unique</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td[text()='unique_to_drop']/../td/a[text()='Drop']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=drop</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Constraint dropped.</td>
</tr>
<tr>
<th colspan="3">8. Drop check</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td[text()='check_to_drop']/../td/a[text()='Drop']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=drop</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Constraint dropped.</td>
</tr>
<tr>
<th colspan="3">Logout</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//div[@class='trail']/descendant::tr/td[1]/a/span[@class='label' and text()='phpPgAdmin']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Servers</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td/a[text()='PostgreSQL']/../../td/a[text()='Logout']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Logged out of PostgreSQL</td>
</tr>
