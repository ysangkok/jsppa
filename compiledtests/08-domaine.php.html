<html>
<head>
				<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
				<title>Domain tests</title>
				</head>
				<body>
				<table cellpadding="1" cellspacing="1" border="1">
				<thead>
				<tr><td rowspan="1" colspan="3">Create and Alter a domain.</td></tr>
				</thead><tbody><tr>
<th colspan="3">Login as janus</th>
</tr>
<tr>
<td>open</td>
<td>http://localhost:8800/ppa/intro.php</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>name=language</td>
<td>English</td>
</tr>
<tr>
<td>open</td>
<td>http://localhost:8800/ppa/login.php?server=localhost:5432:allow&subject=server</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>//input[@name='loginUsername']</td>
<td>admin_user</td>
</tr>
<tr>
<td>type</td>
<td>//input[@id='loginPassword']</td>
<td>super</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=loginSubmit</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//div[@class='topbar']/descendant::span[@class='username']</td>
<td>admin_user</td>
</tr>
<tr>
<th colspan="3">1. create domain</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Databases</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=ppatests_db</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Schemas</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=test_schema</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Domains</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Create domain</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=domname</td>
<td>year</td>
</tr>
<tr>
<td>select</td>
<td>name=domtype</td>
<td>label=integer</td>
</tr>
<tr>
<td>type</td>
<td>name=domdefault</td>
<td>1900</td>
</tr>
<tr>
<td>click</td>
<td>name=domnotnull</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=domcheck</td>
<td>VALUE &gt;= 1901 AND VALUE &lt;= 2155</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//input[@value='Create']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Domain created.</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/td/a[text()='year']</td>
<td>year</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/td/a[text()='year']/../../td[2]</td>
<td>integer</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/td/a[text()='year']/../../td[3]/div</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/td/a[text()='year']/../../td[4]</td>
<td>1900</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/td/a[text()='year']/../../td[5]</td>
<td>admin_user</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=year</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/td[text()='year_check']/../td[2]</td>
<td>CHECK (VALUE >= 1901 AND VALUE <= 2155)</td>
</tr>
<tr>
<th colspan="3">2. add unwanted domain constraint</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//div[@class='trail']/descendant::a[@title='Schema']/span[@class='label' and text()='test_schema']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Domains</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=year</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//a[text()='Add check']</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=name</td>
<td>test_to_drop</td>
</tr>
<tr>
<td>type</td>
<td>name=definition</td>
<td>VALUE > 1900</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=add</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Check constraint added.</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/td[text()='test_to_drop']/../td[2]</td>
<td>CHECK (VALUE > 1900)</td>
</tr>
<tr>
<th colspan="3">3. drop unwanted check constraint on domain</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//div[@class='trail']/descendant::a[@title='Schema']/span[@class='label' and text()='test_schema']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Domains</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=year</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td[text()='test_to_drop']/../td/a[text()='Drop']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[text()='Are you sure you want to drop the constraint "test_to_drop" on "year"?']</td>
<td>Are you sure you want to drop the constraint "test_to_drop" on "year"?</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=drop</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Constraint dropped.</td>
</tr>
<tr>
<th colspan="3">4. alter domain giving owner to super_user</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//div[@class='trail']/descendant::a[@title='Schema']/span[@class='label' and text()='test_schema']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Domains</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td/a[text()='year']/../../td/a[text()='Alter']</td>
<td></td>
</tr>
<tr>
<td>click</td>
<td>name=domnotnull</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>name=domdefault</td>
<td>extract(year from current_date)</td>
</tr>
<tr>
<td>select</td>
<td>name=domowner</td>
<td>janus</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=alter</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Domain altered.</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/th[text()='Not Null']/../td</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/th[text()='Owner']/../td</td>
<td>janus</td>
</tr>
<tr>
<th colspan="3">5. alter back the owner to admin_user</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//div[@class='trail']/descendant::a[@title='Schema']/span[@class='label' and text()='test_schema']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Domains</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td/a[text()='year']/../../td/a[text()='Alter']</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>name=domowner</td>
<td>admin_user</td>
</tr>
<tr>
<td>clickAndWait</td>
<td>name=alter</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Domain altered.</td>
</tr>
<tr>
<td>assertText</td>
<td>//tr/th[text()='Owner']/../td</td>
<td>admin_user</td>
</tr>
<tr>
<th colspan="3">Logout</th>
</tr>
<tr>
<td>clickAndWait</td>
<td>//div[@class='trail']/descendant::tr/td[1]/a/span[@class='label' and text()='phpPgAdmin']</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>link=Servers</td>
<td></td>
</tr>
<tr>
<td>clickAndWait</td>
<td>//tr/td/a[text()='PostgreSQL']/../../td/a[text()='Logout']</td>
<td></td>
</tr>
<tr>
<td>assertText</td>
<td>//p[@class='message']</td>
<td>Logged out of PostgreSQL</td>
</tr>
